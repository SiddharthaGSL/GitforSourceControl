function "main"."db_fun_recreate_cogs_table_ind()" {
  text = """

DECLARE

    VCOUNT bigint;
    -- For TEMP_INVSTOCK Table
    V_TEMP_INVSTOCK_DROP            varchar(100);
    V_TEMP_INVSTOCK_CREATE          varchar(1000);
    V_I_TEMP_INVSTOCK_ADMSITE_CODE  varchar(500);
    V_I_TEMP_INVSTOCK_ERS_CODE      varchar(500);
    V_I_TEMP_INVSTOCK_ENTTYPE       varchar(500);
    V_I_TEMP_INVSTOCK_COMPOSITE1    varchar(500);
    V_I_TEMP_INVSTOCK_ISSECONDARY   varchar(500);
    V_I_TEMP_INVSTOCK_COMPOSITE2    varchar(500);
    V_I_TEMP_INVSTOCK_FAMILY_CODE   varchar(500);
    V_I_TEMP_INVSTOCK_STOCKCODE     varchar(500);
    --for TEMP_ITEM_DT_STOCK
    V_TEMP_ITEM_DT_STOCK_DROP       varchar(100);
    V_TEMP_ITEM_DT_STOCK_CREATE     varchar(500);
    V_I_TEMP_ITEM_DT_STOCK          varchar(500);
    --for TEMP_FIFO_IN_STOCK
    V_TEMP_FIFO_IN_STOCK_DROP       varchar(100);
    V_TEMP_FIFO_IN_STOCK_CREATE     varchar(1000);
    V_I_TEMP_FIFO_IN_STOCK          varchar(500);
    V_I_TEMP_FIFO_IN_STOCK_01       varchar(500);
    V_I_TEMP_FIFO_IN_STOCK_02       varchar(500);
    --for TEMP_FIFO_ITEM
    V_TEMP_FIFO_ITEM_DROP           varchar(100);
    V_TEMP_FIFO_ITEM_CREATE         varchar(100);
    --for TEMP_INVSTOCK_SITE_DATE
    V_TEMP_INVSTOCK_SITE_DATE_DR         varchar(100);
    V_TEMP_INVSTOCK_SITE_DATE_CR        varchar(500);
    V_I_TEMP_INVSTOCK_SITE_DATE         varchar(500);
    --for TEMP_COGS_DT_STOCK
    V_TEMP_COGS_DT_STOCK_DR           varchar(100);
    V_TEMP_COGS_DT_STOCK_CR         varchar(1000);
    V_I_TEMP_COGS_DT_STOCK_01         varchar(500);
    --for TEMP_SITE_MAX_DATE
    V_TEMP_SITE_MAX_DATE_DR            varchar(100);
    V_TEMP_SITE_MAX_DATE_CR            varchar(200);
    I_TEMP_SITE_MAX_DATE            varchar(200);
    -- for TEMP_ITEMPOOL_COGS
    V_TEMP_ITEMPOOL_COGS_DROP           varchar(100);
    V_TEMP_ITEMPOOL_COGS_CREATE         varchar(1000);
    V_I_TEMP_ITEMPOOL_COGS_ICODE        varchar(500);
    V_I_TEMP_ITEMPOOL_COGS_NONINV       varchar(500);
    V_I_TEMP_ITEMPOOL_COGS_MTYPE        varchar(500);
    -- For TEMP_INVSTOCK Table
    v_temp_transaction_upd_drop      varchar(100);
    v_temp_transaction_upd_create    varchar(1000);
    V_I_temp_transaction_upd_01         varchar(500);
    -- for COGS_DIFF_POSTING
--    V_COGS_DIFF_POSTING_DROP
--    V_COGS_DIFF_POSTING_CREATE
--    V_I_COGS_DIFF_POSTING_ICODE
--    V_I_COGS_DIFF_POSTING_SITE
--    V_I_COGS_DIFF_POSTING_MCODE
--    V_I_COGS_DIFF_POSTING_STKC
BEGIN
  /********************************************************************************************************************************
     PURPOSE: NEW COGS.

    REV NO         OWNER            DATE             DESCRIPTION
    ---------     -----------     -----------        ------------------------------------------------------------------------
    REV : 000     DIPTIMAN        01-DEC-2017        (TFS ID : XXXXX) .
    REV : 001     DIPTIMAN        11-SEP-2019        (TFS ID : 41889) Due to this procedure COGS pkg get uncompiled and for this 
                                                                      any connected session gets error.
                                                                      (Amar Kant Singh / Baazar Style Retail)
    REV : 003     DIPTIMAN        14-NOV-2018        (TFS ID : 41863) Updation of detail entries from stock where ref_family_code column is missing.
  *********************************************************************************************************************************/
    -- START REV : 001
    RETURN '1';
    -- END REV : 001
    
    -- To drop and create TEMP_INVSTOCK
    V_TEMP_INVSTOCK_DROP := 'DROP TABLE TEMP_INVSTOCK PURGE';
    V_TEMP_INVSTOCK_CREATE := 'CREATE TABLE TEMP_INVSTOCK(STOCKCODE NUMBER(12), ERS_CODE NUMBER(12), ENTDT DATE, ENTTYPE VARCHAR2(3 BYTE), SUBENTTYPE VARCHAR2(3 BYTE), ICODE VARCHAR2(9 BYTE), DETAIL_ERS_CODE VARCHAR2(50 BYTE), REFPCODE NUMBER(12), QTY NUMBER(20,3), SEQ NUMBER(10), ADMOU_CODE NUMBER(12), ADMSITE_CODE NUMBER(12), ISSECONDARY CHAR(1 BYTE), FIFO_LEVEL CHAR(1 BYTE), SITETYPE VARCHAR2(15 BYTE), REF_FAMILY_CODE NUMBER(12))';
    V_I_TEMP_INVSTOCK_ADMSITE_CODE := 'CREATE INDEX I_TEMP_INVSTOCK_ADMSITE_CODE ON TEMP_INVSTOCK (ADMSITE_CODE) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_ERS_CODE := 'CREATE INDEX I_TEMP_INVSTOCK_ERS_CODE ON TEMP_INVSTOCK (ERS_CODE) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_ENTTYPE :=  'CREATE INDEX I_TEMP_INVSTOCK_ENTTYPE ON TEMP_INVSTOCK (ENTTYPE) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_COMPOSITE1 := 'CREATE INDEX I_TEMP_INVSTOCK_COMPOSITE1 ON TEMP_INVSTOCK (ICODE, ADMOU_CODE, ISSECONDARY) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_ISSECONDARY := 'CREATE INDEX I_TEMP_INVSTOCK_ISSECONDARY ON TEMP_INVSTOCK (ISSECONDARY) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_COMPOSITE2 := 'CREATE INDEX I_TEMP_INVSTOCK_COMPOSITE2 ON TEMP_INVSTOCK (ADMOU_CODE, ADMSITE_CODE, ICODE, ENTDT, STOCKCODE) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_FAMILY_CODE := 'CREATE INDEX I_TEMP_INVSTOCK_FAMILY_CODE ON TEMP_INVSTOCK (REF_FAMILY_CODE) TABLESPACE INDX';
    V_I_TEMP_INVSTOCK_STOCKCODE := 'CREATE INDEX I_TEMP_INVSTOCK_STOCKCODE ON TEMP_INVSTOCK (STOCKCODE) TABLESPACE INDX';
    EXECUTE V_TEMP_INVSTOCK_DROP;
    EXECUTE V_TEMP_INVSTOCK_CREATE;
    EXECUTE V_I_TEMP_INVSTOCK_ADMSITE_CODE;
    EXECUTE V_I_TEMP_INVSTOCK_ERS_CODE;
    EXECUTE V_I_TEMP_INVSTOCK_ENTTYPE;
    EXECUTE V_I_TEMP_INVSTOCK_COMPOSITE1;
    EXECUTE V_I_TEMP_INVSTOCK_ISSECONDARY;
    EXECUTE V_I_TEMP_INVSTOCK_COMPOSITE2;
    EXECUTE V_I_TEMP_INVSTOCK_STOCKCODE;
    -- To drop and create TEMP_ITEM_DT_STOCK
    V_TEMP_ITEM_DT_STOCK_DROP := 'DROP TABLE TEMP_ITEM_DT_STOCK PURGE';
    V_TEMP_ITEM_DT_STOCK_CREATE := 'CREATE TABLE TEMP_ITEM_DT_STOCK(FIFO_LEVEL CHAR(1 BYTE), ADMOU_CODE NUMBER(12), ADMSITE_CODE NUMBER(12), ICODE VARCHAR2(9 BYTE), DT DATE, QTY NUMBER(20,3))';
    V_I_TEMP_ITEM_DT_STOCK := 'CREATE INDEX I_TEMP_ITEM_DT_STOCK ON TEMP_ITEM_DT_STOCK(ADMOU_CODE, ADMSITE_CODE, ICODE, DT)TABLESPACE INDX';
    EXECUTE V_TEMP_ITEM_DT_STOCK_DROP;
    EXECUTE V_TEMP_ITEM_DT_STOCK_CREATE;
    EXECUTE V_I_TEMP_ITEM_DT_STOCK;
    -- To drop and create TEMP_FIFO_IN_STOCK
    V_TEMP_FIFO_IN_STOCK_DROP := 'DROP TABLE TEMP_FIFO_IN_STOCK PURGE';
    V_TEMP_FIFO_IN_STOCK_CREATE := 'CREATE TABLE TEMP_FIFO_IN_STOCK(FIFO_LEVEL CHAR(1 BYTE), ADMOU_CODE NUMBER(12), ADMSITE_CODE NUMBER(12), ICODE VARCHAR2(9 BYTE), STOCKCODE NUMBER(12), ENTDT DATE, QTY NUMBER(20,3), RATE NUMBER(20,3), SITE_RATE NUMBER(20,3), REF_FAMILY_CODE NUMBER(12))';
    V_I_TEMP_FIFO_IN_STOCK := 'CREATE INDEX I_TEMP_FIFO_IN_STOCK ON TEMP_FIFO_IN_STOCK(ADMOU_CODE, ADMSITE_CODE, ICODE, ENTDT) TABLESPACE INDX';
    V_I_TEMP_FIFO_IN_STOCK_01 := 'CREATE INDEX I_TEMP_FIFO_IN_STOCK_01 ON TEMP_FIFO_IN_STOCK (STOCKCODE, FIFO_LEVEL) TABLESPACE INDX';
    V_I_TEMP_FIFO_IN_STOCK_02 := 'CREATE INDEX I_TEMP_FIFO_IN_STOCK_02 ON TEMP_FIFO_IN_STOCK (REF_FAMILY_CODE) TABLESPACE INDX';
    EXECUTE V_TEMP_FIFO_IN_STOCK_DROP;
    EXECUTE V_TEMP_FIFO_IN_STOCK_CREATE;
    EXECUTE V_I_TEMP_FIFO_IN_STOCK;
    EXECUTE V_I_TEMP_FIFO_IN_STOCK_01;
    EXECUTE V_I_TEMP_FIFO_IN_STOCK_02;
    -- To drop and create TEMP_FIFO_ITEM
    V_TEMP_FIFO_ITEM_DROP := 'DROP TABLE TEMP_FIFO_ITEM PURGE';
    V_TEMP_FIFO_ITEM_CREATE := 'CREATE TABLE TEMP_FIFO_ITEM(ICODE VARCHAR2(9 BYTE))';
    EXECUTE V_TEMP_FIFO_ITEM_DROP;
    EXECUTE V_TEMP_FIFO_ITEM_CREATE;
    -- To drop and create TEMP_INVSTOCK_SITE_DATE
    V_TEMP_INVSTOCK_SITE_DATE_DR := 'DROP TABLE TEMP_INVSTOCK_SITE_DATE PURGE';
    V_TEMP_INVSTOCK_SITE_DATE_CR := 'CREATE TABLE TEMP_INVSTOCK_SITE_DATE(ADMOU_CODE NUMBER(12), ADMSITE_CODE NUMBER(12), SITETYPE VARCHAR2(15 BYTE), ICODE VARCHAR2(9 BYTE), ENTDT DATE)';
    V_I_TEMP_INVSTOCK_SITE_DATE := 'CREATE INDEX I_TEMP_INVSTOCK_SITE_DATE ON TEMP_INVSTOCK_SITE_DATE (ADMSITE_CODE, ICODE) TABLESPACE INDX';
    EXECUTE V_TEMP_INVSTOCK_SITE_DATE_DR;
    EXECUTE V_TEMP_INVSTOCK_SITE_DATE_CR;
    EXECUTE V_I_TEMP_INVSTOCK_SITE_DATE;
    -- To drop and create TEMP_COGS_DT_STOCK
    V_TEMP_COGS_DT_STOCK_DR := 'DROP TABLE TEMP_COGS_DT_STOCK PURGE';
    V_TEMP_COGS_DT_STOCK_CR := 'CREATE TABLE TEMP_COGS_DT_STOCK(ADMOU_CODE NUMBER(12), ADMSITE_CODE NUMBER(12), ICODE VARCHAR2(9 BYTE) NOT NULL, ENTDT DATE NOT NULL, QTY NUMBER(20,3), STOCKCODE NUMBER(12), ENTTYPE VARCHAR2(3), SUBENTTYPE VARCHAR2(3))';
    V_I_TEMP_COGS_DT_STOCK_01 := 'CREATE INDEX I_TEMP_COGS_DT_STOCK_01 ON TEMP_COGS_DT_STOCK (STOCKCODE) TABLESPACE INDX';
    EXECUTE V_TEMP_COGS_DT_STOCK_DR;
    EXECUTE V_TEMP_COGS_DT_STOCK_CR;
    EXECUTE V_I_TEMP_COGS_DT_STOCK_01;
    --TO drop and create TEMP_SITE_MAX_DATE
    V_TEMP_SITE_MAX_DATE_DR := 'DROP TABLE TEMP_SITE_MAX_DATE PURGE';
    V_TEMP_SITE_MAX_DATE_CR := 'CREATE TABLE TEMP_SITE_MAX_DATE(ADMOU_CODE NUMBER(12),ADMSITE_CODE NUMBER(12),ICODE VARCHAR2(9 BYTE), DT  DATE)';
    I_TEMP_SITE_MAX_DATE:= 'CREATE INDEX TEMP_SITE_MAX_DATE_I01 ON TEMP_SITE_MAX_DATE(ADMOU_CODE, ADMSITE_CODE, ICODE, DT)';
    EXECUTE V_TEMP_SITE_MAX_DATE_DR;
    EXECUTE V_TEMP_SITE_MAX_DATE_CR;
    EXECUTE I_TEMP_SITE_MAX_DATE;
    -- To drop and create TEMP_ITEMPOOL_COGS
    V_TEMP_ITEMPOOL_COGS_DROP       := 'DROP TABLE TEMP_ITEMPOOL_COGS PURGE';
    V_TEMP_ITEMPOOL_COGS_CREATE     := 'CREATE TABLE TEMP_ITEMPOOL_COGS (ICODE VARCHAR2(9), NONINVENTORY CHAR(1), MATERIAL_TYPE CHAR(1), LEV NUMBER(3))';
    V_I_TEMP_ITEMPOOL_COGS_ICODE    := 'CREATE INDEX I_TEMP_ITEMPOOL_COGS_01 ON TEMP_ITEMPOOL_COGS (ICODE) TABLESPACE INDX';
    V_I_TEMP_ITEMPOOL_COGS_NONINV   := 'CREATE INDEX I_TEMP_ITEMPOOL_COGS_02 ON TEMP_ITEMPOOL_COGS (NONINVENTORY) TABLESPACE INDX';
    V_I_TEMP_ITEMPOOL_COGS_MTYPE    := 'CREATE INDEX I_TEMP_ITEMPOOL_COGS_03 ON TEMP_ITEMPOOL_COGS (MATERIAL_TYPE) TABLESPACE INDX';
    EXECUTE V_TEMP_ITEMPOOL_COGS_DROP;
    EXECUTE V_TEMP_ITEMPOOL_COGS_CREATE;
    EXECUTE V_I_TEMP_ITEMPOOL_COGS_ICODE;
    EXECUTE V_I_TEMP_ITEMPOOL_COGS_NONINV;
    EXECUTE V_I_TEMP_ITEMPOOL_COGS_MTYPE;
    -- To drop and create temp_transaction_update
    v_temp_transaction_upd_drop   := 'drop table temp_transaction_update purge';
    -- start rev : 003
    -- v_temp_transaction_upd_create := 'create table temp_transaction_update (stockcode number(12), ref_family_code number(12), tablename varchar2(30), costrate number) nologging';
    v_temp_transaction_upd_create := 'create table temp_transaction_update (stockcode number(12), ref_family_code number(12), tablename varchar2(30), costrate number, detail_code varchar2(50), pk_colname varchar2(50), trn_upd_col_name varchar2(30)) nologging';
    -- end rev : 003
    v_i_temp_transaction_upd_01   := 'create index temp_transaction_update_i01 on temp_transaction_update (tablename) tablespace indx';
    EXECUTE v_temp_transaction_upd_drop;
    EXECUTE v_temp_transaction_upd_create;
    EXECUTE v_i_temp_transaction_upd_01;
    SELECT  SUM((date_trunc('day', clock_timestamp())-date_trunc('day', CREATED))::numeric )
    INTO STRICT    VCOUNT
    FROM    DBA_OBJECTS
    WHERE   OWNER = USER
    AND     OBJECT_NAME IN (    'TEMP_INVSTOCK'
                            ,'TEMP_ITEM_DT_STOCK'
                            ,'TEMP_FIFO_IN_STOCK'
                            ,'TEMP_FIFO_ITEM'
                            ,'TEMP_INVSTOCK_SITE_DATE'
                            ,'TEMP_COGS_DT_STOCK'
                            , 'TEMP_SITE_MAX_DATE'
                            ,'TEMP_ITEMPOOL_COGS'
                            ,'TEMP_TRANSACTION_UPDATE'
                        );
    IF   VCOUNT = 0 THEN
        RETURN '1';
    ELSE
        RETURN '0';
    END IF;
END;
"""
  returnType = character
  arguments = [
  ]
  language = plpgsql
  volatility = STABLE
}

